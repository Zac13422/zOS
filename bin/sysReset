local answered = false
local answer = nil
local branch = nil




if fs.exists("/bin/zsh") then
	while not answered do
		text.warn("You're about to reset the system.")
		write("Do you want to continue? (y/N) ")
		answer = read()
		if answer=="y" then
			print("2 branches are available!")
			print("1 : Master (or stable)")
			print("2 : Testing (or unstable)")
			local setBranch = false
			local _branch = "none"
			while not setBranch do
				write("Choose the branch (1/2) >")
				answer = read()
       
				if answer=="2" then
					print("Branch have been set to testing")
					branch = "testing"
					setBranch = true
				elseif answer=="1" then
					print("Branch have been set to master")
					branch = "master"
					setBranch = true
				else
					print("[Error] Invalid number!")
				end
			end
			if fs.exists("/etc/zpm/sysbranch") then
				fs.delete("/etc/zpm/sysbranch")
			end
			file = fs.open("/etc/zpm/sysbranch", "w")
			file.write(branch)
			file.close()
			text.info("Beginning system reset..")
		elseif answer=="n" or answer=="" then
			text.info("Reset cancelled.")
			return
		end
	end
else
	if fs.exists("/etc/zpm/sysbranch") then
		file=fs.open("/etc/zpm/sysbranch", "r")
		branch = file.readLine()
		file.close()
	else
		branch = "master
	end
	text.info("Gathering files from "..branch.." branch...")
end

if term.isColor() then term.setTextColor(colors.blue) end

function Done()
	if term.isColor() then term.setTextColor(colors.lime) end
	print("Done")
        if term.isColor() then term.setTextColor(colors.blue) end
end
 
function Download(path)
	write("[Info] Downloading "..branch.."/"..path.."...")
	data = http.get("https://raw.githubusercontent.com/Zac13422/zOS/"..branch..path)
        data = data.readAll()
        local file = fs.open(path, "w")
        file.write(data)
        file.close()
        Done() 
end
 

text.info("Deleting old files...")
fs.delete("/api/*")
fs.delete("/bin/*")
Done()s
      
Download("/.settings")
Download("/startup")
Download("/api/text")
Download("/api/system")
Download("/api/user")
Download("/bin/cd")
Download("/bin/cp")
Download("/bin/date")
Download("/bin/edit")
Download("/bin/hidden/login")
Download("/bin/logout")
Download("/bin/lua")
Download("/bin/mkdir")
Download("/bin/mv")
Download("/bin/passwd")
Download("/bin/pwd")
Download("/bin/reboot")
Download("/bin/rename")
Download("/bin/rm")
Download("/bin/shutdown")
Download("/bin/zpm")  
Download("/bin/zsh")
Download("/bin/useradd")

os.reboot()
